<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>/vibe ‚Äî Hub</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'SF Mono', Monaco, 'Consolas', monospace;
      background: #0a0a0a;
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* HEADER */
    .hero {
      margin-bottom: 60px;
      text-align: center;
    }

    .hero h1 {
      font-size: 48px;
      font-weight: 600;
      background: linear-gradient(90deg, #6B8FFF, #a855f7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 12px;
    }

    .hero .tagline {
      font-size: 16px;
      color: #888;
      margin-bottom: 24px;
    }

    .hero .stats {
      display: flex;
      justify-content: center;
      gap: 32px;
      font-size: 14px;
      color: #666;
      margin-top: 20px;
    }

    .hero .stats span {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hero .stats .live { color: #4a4; font-size: 20px; }

    /* SECTION */
    .section {
      margin-bottom: 60px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid #222;
    }

    .section-header h2 {
      font-size: 18px;
      font-weight: 600;
      color: #6B8FFF;
    }

    .section-header .expand {
      font-size: 13px;
      color: #666;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
    }

    .section-header .expand:hover { color: #6B8FFF; }

    /* WHO'S BUILDING */
    .people-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }

    .person {
      background: #111;
      border: 1px solid #222;
      border-radius: 8px;
      padding: 12px;
      transition: border-color 0.2s;
    }

    .person:hover { border-color: #6B8FFF; }

    .person .handle {
      font-size: 14px;
      font-weight: 600;
      color: #6B8FFF;
      margin-bottom: 4px;
    }

    .person .building {
      font-size: 12px;
      color: #888;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .person .status {
      font-size: 10px;
      color: #4a4;
      margin-top: 6px;
    }

    /* ACTIVITY FEED */
    .activity-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .activity-item {
      background: #111;
      border: 1px solid #222;
      border-left: 3px solid #6B8FFF;
      border-radius: 8px;
      padding: 16px;
      transition: border-color 0.2s;
    }

    .activity-item:hover { border-left-color: #a855f7; }

    .activity-item.shipped { border-left-color: #4a4; }
    .activity-item.idea { border-left-color: #fa4; }
    .activity-item.request { border-left-color: #a4f; }

    .activity-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 12px;
    }

    .activity-meta .type {
      font-size: 16px;
    }

    .activity-meta .author {
      color: #6B8FFF;
      font-weight: 600;
    }

    .activity-meta .verb {
      color: #666;
    }

    .activity-meta .time {
      color: #555;
      margin-left: auto;
    }

    .activity-content {
      font-size: 14px;
      line-height: 1.6;
      color: #ccc;
      margin-bottom: 8px;
    }

    .activity-link {
      font-size: 12px;
      color: #6B8FFF;
      text-decoration: none;
      word-break: break-all;
    }

    .activity-link:hover { text-decoration: underline; }

    .activity-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .activity-tag {
      font-size: 11px;
      color: #888;
      background: #1a1a1a;
      padding: 2px 8px;
      border-radius: 4px;
    }

    /* CTA */
    .cta {
      background: linear-gradient(135deg, #111 0%, #1a1a2a 100%);
      border: 1px solid #6B8FFF;
      border-radius: 12px;
      padding: 32px;
      text-align: center;
    }

    .cta h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #6B8FFF;
    }

    .cta p {
      font-size: 13px;
      color: #888;
      margin-bottom: 20px;
    }

    .cta code {
      display: block;
      background: #0a0a0a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 16px;
      font-size: 14px;
      color: #6B8FFF;
      margin-bottom: 16px;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .cta code:hover { border-color: #6B8FFF; }

    .cta .hint {
      font-size: 12px;
      color: #666;
    }

    /* LOADING/EMPTY */
    .loading, .empty {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 13px;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .hero h1 { font-size: 36px; }
      .hero .stats { flex-direction: column; gap: 12px; }
      .people-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="hero">
      <h1>/vibe</h1>
      <div class="tagline">Terminal-native social for builders</div>
      <div class="stats">
        <span><span class="live">‚óè</span> <strong id="online-count">‚Äî</strong> building right now</span>
        <span>‚ö° <strong id="total-count">‚Äî</strong> builders total</span>
        <span>üå± <strong id="genesis-remaining">‚Äî</strong> genesis spots left</span>
      </div>
    </div>

    <!-- WHO'S BUILDING -->
    <div class="section">
      <div class="section-header">
        <h2>Who's Building</h2>
        <button class="expand" id="people-expand" onclick="togglePeople()">see all</button>
      </div>
      <div id="people-loading" class="loading">Loading...</div>
      <div id="people-content" class="people-grid" style="display: none;"></div>
    </div>

    <!-- WHAT'S HAPPENING -->
    <div class="section">
      <div class="section-header">
        <h2>What's Happening</h2>
      </div>
      <div id="activity-loading" class="loading">Loading...</div>
      <div id="activity-content" class="activity-list" style="display: none;"></div>
    </div>

    <!-- GET STARTED -->
    <div class="cta">
      <h3>Join /vibe</h3>
      <p>Install the MCP server and start building with others</p>
      <code onclick="copyInstall()">bash &lt;(curl -fsSL slashvibe.dev/install)</code>
      <div class="hint">Then say: <strong>"let's vibe"</strong></div>
    </div>
  </div>

  <script>
    let showAllPeople = false;

    // Copy install command
    function copyInstall() {
      const cmd = "bash <(curl -fsSL slashvibe.dev/install)";
      navigator.clipboard.writeText(cmd).then(() => {
        alert('Install command copied to clipboard!');
      });
    }

    // Toggle people view
    function togglePeople() {
      showAllPeople = !showAllPeople;
      loadPeople();
    }

    // Load who's building
    async function loadPeople() {
      try {
        const res = await fetch('/api/presence/who');
        const data = await res.json();

        const active = data.active || [];
        const online = active.length;

        document.getElementById('online-count').textContent = online;

        // Show first 8 by default, all if expanded
        const displayCount = showAllPeople ? active.length : Math.min(8, active.length);
        const people = active.slice(0, displayCount);

        const content = document.getElementById('people-content');

        if (people.length === 0) {
          content.innerHTML = '<div class="empty">No one online right now. Be the first!</div>';
        } else {
          content.innerHTML = people.map(person => `
            <div class="person">
              <div class="handle">@${person.handle || person.username}</div>
              <div class="building">${person.workingOn || person.building || person.one_liner || 'Building something'}</div>
              <div class="status">‚óè online ${formatTime(person.lastSeen)}</div>
            </div>
          `).join('');
        }

        // Update expand button
        const expandBtn = document.getElementById('people-expand');
        if (active.length <= 8) {
          expandBtn.style.display = 'none';
        } else {
          expandBtn.style.display = 'block';
          expandBtn.textContent = showAllPeople ? 'show less' : `see all ${active.length}`;
        }

        document.getElementById('people-loading').style.display = 'none';
        content.style.display = 'grid';
      } catch (e) {
        console.error('Failed to load people:', e);
        document.getElementById('people-loading').textContent = 'Failed to load';
      }
    }

    // Load activity feed
    async function loadActivity() {
      try {
        const res = await fetch('/api/feed');
        const data = await res.json();

        const content = document.getElementById('activity-content');

        if (!data.items || data.items.length === 0) {
          content.innerHTML = '<div class="empty">No activity yet. Ship something from your terminal!</div>';
        } else {
          content.innerHTML = data.items.map(item => {
            const type = item.type || 'general';
            const emoji = { shipped: 'üöÄ', idea: 'üí°', request: 'üîì', riff: '‚Ü≥' }[type] || 'üìù';
            const verb = { shipped: 'shipped', idea: 'had an idea', request: 'requested', riff: 'riffed on' }[type] || 'posted';

            return `
              <div class="activity-item ${type}">
                <div class="activity-meta">
                  <span class="type">${emoji}</span>
                  <span class="author">@${item.handle || item.author}</span>
                  <span class="verb">${verb}</span>
                  <span class="time">${formatTime(item.timestamp)}</span>
                </div>
                <div class="activity-content">${item.what || item.content}</div>
                ${item.url ? `<a href="${item.url}" target="_blank" class="activity-link">${item.url}</a>` : ''}
                ${item.tags && item.tags.length ? `
                  <div class="activity-tags">
                    ${item.tags.map(t => `<span class="activity-tag">#${t}</span>`).join('')}
                  </div>
                ` : ''}
              </div>
            `;
          }).join('');
        }

        document.getElementById('activity-loading').style.display = 'none';
        content.style.display = 'flex';
      } catch (e) {
        console.error('Failed to load activity:', e);
        document.getElementById('activity-loading').textContent = 'Failed to load';
      }
    }

    // Load stats
    async function loadStats() {
      try {
        const res = await fetch('/api/users?all=true');
        const data = await res.json();
        document.getElementById('total-count').textContent = data.users?.length || 0;

        // Genesis spots
        const statsRes = await fetch('/api/admin/stats');
        const stats = await statsRes.json();
        if (stats.health?.genesis_remaining !== undefined) {
          document.getElementById('genesis-remaining').textContent = stats.health.genesis_remaining;
        }
      } catch (e) {
        console.error('Failed to load stats:', e);
      }
    }

    // Format timestamp
    function formatTime(timestamp) {
      if (!timestamp) return '';
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;

      if (diff < 60000) return 'just now';
      if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
      if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
      return Math.floor(diff / 86400000) + 'd ago';
    }

    // Auto-refresh every 30 seconds
    setInterval(() => {
      loadPeople();
      loadActivity();
      loadStats();
    }, 30000);

    // Initial load
    loadPeople();
    loadActivity();
    loadStats();
  </script>
</body>
</html>
